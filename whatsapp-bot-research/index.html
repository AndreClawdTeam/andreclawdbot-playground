<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>WhatsApp Bot â€” Guia de ImplementaÃ§Ã£o</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --bg:#0f1117;--surface:#1a1d27;--surface2:#242736;--surface3:#2d3047;
    --accent:#25d366;--accent2:#128c7e;--accent3:#34b7f1;
    --danger:#e74c3c;--warn:#f39c12;--info:#3498db;
    --text:#e8eaf6;--muted:#8b92b2;--border:#2d3047;
    --code-bg:#12141e;--radius:10px;
  }
  body{font-family:'Segoe UI',system-ui,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;line-height:1.6}
  header{background:linear-gradient(135deg,#0d1b12 0%,#1a2d20 50%,#0f1117 100%);border-bottom:1px solid var(--border);padding:28px 40px 20px;display:flex;align-items:center;gap:18px}
  header .logo{width:52px;height:52px;background:var(--accent);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;flex-shrink:0}
  header h1{font-size:1.8rem;font-weight:700;color:var(--text)}
  header h1 span{color:var(--accent)}
  header p{color:var(--muted);font-size:.9rem;margin-top:3px}
  nav{background:var(--surface);border-bottom:1px solid var(--border);padding:0 40px;display:flex;gap:4px;overflow-x:auto}
  nav button{background:none;border:none;color:var(--muted);padding:14px 20px;cursor:pointer;font-size:.9rem;border-bottom:2px solid transparent;transition:.2s;white-space:nowrap;font-family:inherit}
  nav button:hover{color:var(--text)}
  nav button.active{color:var(--accent);border-bottom-color:var(--accent);font-weight:600}
  main{max-width:1100px;margin:0 auto;padding:32px 40px}
  section{display:none}
  section.active{display:block}
  h2{font-size:1.5rem;font-weight:700;margin-bottom:6px;color:var(--text)}
  h2 .badge{font-size:.7rem;background:var(--accent2);color:#fff;padding:2px 8px;border-radius:20px;margin-left:10px;vertical-align:middle;font-weight:500}
  .subtitle{color:var(--muted);margin-bottom:28px;font-size:.95rem}
  .card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:22px 26px;margin-bottom:20px}
  .card h3{font-size:1.1rem;font-weight:600;margin-bottom:10px;display:flex;align-items:center;gap:8px}
  .card h3 .icon{font-size:1.3rem}
  .card p,.card li{color:var(--muted);font-size:.9rem;line-height:1.7}
  .card ul{padding-left:20px;margin-top:6px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
  .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px}
  .tag{display:inline-block;font-size:.72rem;padding:2px 8px;border-radius:12px;font-weight:600;margin:2px}
  .tag.green{background:#0d2b1a;color:var(--accent);border:1px solid #1a5c33}
  .tag.blue{background:#0d1f2b;color:var(--accent3);border:1px solid #1a3d5c}
  .tag.red{background:#2b0d0d;color:var(--danger);border:1px solid #5c1a1a}
  .tag.yellow{background:#2b1d0d;color:var(--warn);border:1px solid #5c3d1a}
  .tbl-wrap{overflow-x:auto;margin:16px 0;border-radius:var(--radius);border:1px solid var(--border)}
  table{width:100%;border-collapse:collapse;font-size:.85rem}
  th{background:var(--surface2);padding:12px 16px;text-align:left;color:var(--text);font-weight:600;border-bottom:1px solid var(--border)}
  td{padding:11px 16px;border-bottom:1px solid var(--border);color:var(--muted);vertical-align:top}
  tr:last-child td{border-bottom:none}
  tr:hover td{background:var(--surface2)}
  td.good{color:var(--accent)}
  td.bad{color:var(--danger)}
  td.warn{color:var(--warn)}
  td strong{color:var(--text)}
  pre{background:var(--code-bg);border:1px solid var(--border);border-radius:8px;padding:18px 22px;overflow-x:auto;margin:14px 0;font-size:.82rem;line-height:1.7}
  code{font-family:'JetBrains Mono','Fira Code','Consolas',monospace}
  .kw{color:#c792ea}.fn{color:#82aaff}.str{color:#c3e88d}.cm{color:#546e7a;font-style:italic}
  .num{color:#f78c6c}.tp{color:#ffcb6b}.op{color:#89ddff}.prop{color:#f07178}
  .cost-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px 24px;text-align:center}
  .cost-card .price{font-size:2rem;font-weight:800;color:var(--accent);margin:8px 0 4px}
  .cost-card .price.paid{color:var(--warn)}
  .cost-card .label{color:var(--text);font-weight:600;font-size:.95rem}
  .cost-card .desc{color:var(--muted);font-size:.82rem;margin-top:6px}
  .alert{padding:12px 18px;border-radius:8px;font-size:.88rem;margin:14px 0;display:flex;gap:10px;align-items:flex-start}
  .alert.warn{background:#1e1508;border:1px solid #5c3d1a;color:var(--warn)}
  .alert.info{background:#080f1e;border:1px solid #1a3d5c;color:var(--accent3)}
  .alert.success{background:#080f0d;border:1px solid #1a5c33;color:var(--accent)}
  .steps{list-style:none;padding:0;margin:16px 0;counter-reset:step}
  .steps li{counter-increment:step;display:flex;gap:14px;margin-bottom:16px;align-items:flex-start}
  .steps li::before{content:counter(step);background:var(--accent2);color:#fff;min-width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.85rem;flex-shrink:0;margin-top:1px}
  .steps li .txt{color:var(--muted);font-size:.9rem}
  .steps li .txt strong{color:var(--text)}
  .rec{background:linear-gradient(135deg,#0a2018 0%,#0d2b1a 100%);border:1px solid #1a5c33;border-radius:var(--radius);padding:20px 26px;display:flex;gap:16px;align-items:center;margin-bottom:24px}
  .rec .star{font-size:2rem}
  .rec h3{color:var(--accent);font-size:1.1rem;margin-bottom:4px}
  .rec p{color:var(--muted);font-size:.88rem}
  .arch{display:flex;align-items:center;gap:0;flex-wrap:wrap;margin:20px 0}
  .arch-box{background:var(--surface2);border:1px solid var(--border);border-radius:8px;padding:10px 16px;font-size:.82rem;color:var(--text);text-align:center;min-width:100px}
  .arch-box.green{border-color:var(--accent);color:var(--accent)}
  .arch-box.blue{border-color:var(--accent3);color:var(--accent3)}
  .arch-box.purple{border-color:#c792ea;color:#c792ea}
  .arch-arrow{color:var(--muted);font-size:1.2rem;padding:0 8px}
  footer{text-align:center;padding:24px;color:var(--muted);font-size:.8rem;border-top:1px solid var(--border);margin-top:40px}
  @media(max-width:700px){.grid2,.grid3{grid-template-columns:1fr}main{padding:20px 16px}header{padding:20px 16px}}
</style>
</head>
<body>

<header>
  <div class="logo">ğŸ’¬</div>
  <div>
    <h1>WhatsApp <span>Bot</span> â€” Guia de ImplementaÃ§Ã£o</h1>
    <p>Stacks Â· Deploy Â· Custos Â· Arquitetura de Fluxos Â· TypeScript</p>
  </div>
</header>

<nav id="nav">
  <button class="active" data-tab="libraries">ğŸ“¦ Bibliotecas</button>
  <button data-tab="deploy">ğŸš€ Deploy</button>
  <button data-tab="costs">ğŸ’° Custos</button>
  <button data-tab="flows">ğŸ”€ Fluxos &amp; Arquitetura</button>
  <button data-tab="quickstart">âš¡ Quick Start</button>
</nav>

<main>

<!-- TAB 1: BIBLIOTECAS -->
<section id="libraries" class="active">
  <h2>Bibliotecas &amp; SDKs <span class="badge">5 opÃ§Ãµes</span></h2>
  <p class="subtitle">Comparativo das principais formas de criar bots no WhatsApp com TypeScript/Node.js.</p>

  <div class="rec">
    <div class="star">â­</div>
    <div>
      <h3>Recomendado para TypeScript: Baileys</h3>
      <p>ConexÃ£o direta via WebSocket (sem browser), escrito nativamente em TypeScript, lightweight, 8k+ stars no GitHub. Ideal para bots de produÃ§Ã£o em Node.js.</p>
    </div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr>
          <th>Biblioteca</th>
          <th>Tipo</th>
          <th>TS Nativo</th>
          <th>Mecanismo</th>
          <th>RAM Aprox.</th>
          <th>Risco Ban</th>
          <th>Stars</th>
          <th>Melhor Para</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Baileys</strong> <span class="tag green">â­ Top TS</span></td>
          <td>NÃ£o-oficial</td>
          <td class="good">âœ… Sim</td>
          <td>WebSocket direto</td>
          <td class="good">~50â€“100 MB</td>
          <td class="warn">MÃ©dio</td>
          <td>8k+</td>
          <td>Bots TS, leve, produÃ§Ã£o</td>
        </tr>
        <tr>
          <td><strong>whatsapp-web.js</strong></td>
          <td>NÃ£o-oficial</td>
          <td class="warn">âš ï¸ Parcial</td>
          <td>Puppeteer/Chrome</td>
          <td class="bad">~500 MB+</td>
          <td class="warn">MÃ©dio</td>
          <td>15k+</td>
          <td>API simples, protÃ³tipos</td>
        </tr>
        <tr>
          <td><strong>WPPConnect</strong></td>
          <td>NÃ£o-oficial</td>
          <td class="good">âœ… Sim</td>
          <td>Puppeteer/Chrome</td>
          <td class="bad">~500 MB+</td>
          <td class="warn">MÃ©dio</td>
          <td>3.5k+</td>
          <td>REST API wrapper</td>
        </tr>
        <tr>
          <td><strong>Meta Cloud API</strong> <span class="tag blue">Oficial</span></td>
          <td>Oficial Meta</td>
          <td class="good">âœ… Sim</td>
          <td>Webhook + REST</td>
          <td class="good">Serverless ok</td>
          <td class="good">Zero</td>
          <td>â€”</td>
          <td>ProduÃ§Ã£o empresarial</td>
        </tr>
        <tr>
          <td><strong>Twilio</strong></td>
          <td>Oficial (wrapper)</td>
          <td class="good">âœ… SDK</td>
          <td>REST + Webhook</td>
          <td class="good">Serverless ok</td>
          <td class="good">Zero</td>
          <td>â€”</td>
          <td>Simples, sandbox gratuita</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="grid2">
    <div class="card">
      <h3><span class="icon">ğŸ”Œ</span> Baileys â€” Destaques</h3>
      <ul>
        <li>WebSocket direto com servidores WhatsApp â€” sem Selenium nem Puppeteer</li>
        <li>Suporte multi-device nativo</li>
        <li>Envio/recebimento de mÃ­dia, grupos, botÃµes</li>
        <li>EventEmitter para escuta de eventos em tempo real</li>
        <li>100% TypeScript â€” tipagem completa incluÃ­da</li>
        <li>Node 17+ necessÃ¡rio</li>
      </ul>
      <br/>
      <span class="tag red">âš  NÃ£o-oficial</span>
      <span class="tag yellow">Uso massivo = risco</span>
      <span class="tag green">Gratuito</span>
    </div>
    <div class="card">
      <h3><span class="icon">ğŸ¢</span> Meta Cloud API â€” Destaques</h3>
      <ul>
        <li>API oficial â€” zero risco de ban ou suspensÃ£o</li>
        <li>Webhook para receber mensagens (sem sessÃ£o persistente)</li>
        <li>Templates de mensagem aprovados pelo Meta</li>
        <li>Suporte a botÃµes, listas, mÃ­dia, fluxos interativos</li>
        <li>NÃºmero de telefone dedicado (WABA obrigatÃ³rio)</li>
        <li>AprovaÃ§Ã£o + verificaÃ§Ã£o de negÃ³cio necessÃ¡ria</li>
      </ul>
      <br/>
      <span class="tag green">Oficial &amp; Seguro</span>
      <span class="tag yellow">AprovaÃ§Ã£o necessÃ¡ria</span>
      <span class="tag blue">Per-message pricing</span>
    </div>
    <div class="card">
      <h3><span class="icon">ğŸŒ</span> whatsapp-web.js â€” Destaques</h3>
      <ul>
        <li>API mais simples e documentada entre as nÃ£o-oficiais</li>
        <li>15k+ stars â€” maior comunidade</li>
        <li>Usa Puppeteer (Chrome headless) â€” alto consumo de RAM</li>
        <li>Tipagem parcial via @types externos</li>
        <li>Mais fÃ¡cil de aprender para quem vem do JS</li>
      </ul>
      <br/>
      <span class="tag red">Alto uso de RAM</span>
      <span class="tag yellow">Puppeteer obrigatÃ³rio</span>
      <span class="tag green">Comunidade enorme</span>
    </div>
    <div class="card">
      <h3><span class="icon">ğŸ“¡</span> Twilio â€” Destaques</h3>
      <ul>
        <li>Sandbox gratuita para testes imediatos</li>
        <li>SDK TypeScript oficial (@twilio/conversations)</li>
        <li>Webhook simples, deploy serverless fÃ¡cil</li>
        <li>Precisa de aprovaÃ§Ã£o + nÃºmero Twilio dedicado</li>
        <li>Custo mais alto por mensagem que Meta direta</li>
      </ul>
      <br/>
      <span class="tag blue">SDK Oficial TS</span>
      <span class="tag yellow">Sandbox gratuita</span>
      <span class="tag red">Custo mais elevado</span>
    </div>
  </div>
</section>

<!-- TAB 2: DEPLOY -->
<section id="deploy">
  <h2>Deploy &amp; Infraestrutura</h2>
  <p class="subtitle">O que muda no deploy dependendo da abordagem escolhida.</p>

  <div class="grid2">
    <div class="card">
      <h3><span class="icon">ğŸ”´</span> Libs NÃ£o-Oficiais (Baileys, wwjs, WPP)</h3>
      <ul>
        <li>Requerem <strong>sessÃ£o persistente</strong> â€” bot fica conectado 24/7 via WebSocket</li>
        <li>AutenticaÃ§Ã£o via QR Code na primeira execuÃ§Ã£o</li>
        <li>Estado de auth salvo em arquivos locais ou banco de dados</li>
        <li><strong>NÃ£o funciona com serverless</strong> (Lambda, Vercel, CF Workers)</li>
        <li>Necessita VPS ou container sempre ativo</li>
        <li>whatsapp-web.js exige Chrome headless instalado no servidor</li>
      </ul>
    </div>
    <div class="card">
      <h3><span class="icon">âœ…</span> Meta Cloud API (Oficial)</h3>
      <ul>
        <li>Baseada em <strong>webhooks</strong> â€” completamente stateless</li>
        <li>Funciona perfeitamente com <strong>serverless</strong> (Lambda, Vercel, etc.)</li>
        <li>NÃ£o precisa de sessÃ£o ativa â€” sÃ³ URL pÃºblica para receber eventos</li>
        <li>URL de webhook deve ser HTTPS com certificado vÃ¡lido</li>
        <li>Necessita nÃºmero de telefone aprovado e WABA configurado no Meta</li>
      </ul>
    </div>
  </div>

  <h3 style="margin:24px 0 12px;color:var(--text)">ğŸ—ï¸ OpÃ§Ãµes de Infraestrutura</h3>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>Plataforma</th><th>Tipo</th><th>CompatÃ­vel com</th><th>Custo/mÃªs</th><th>SessÃ£o Persistente</th><th>Indicado para</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>VPS (Hetzner, DigitalOcean)</strong></td>
          <td>VPS</td>
          <td>Qualquer lib</td>
          <td class="warn">$4â€“$12/mÃªs</td>
          <td class="good">âœ… Sim</td>
          <td>Baileys, wwjs, produÃ§Ã£o</td>
        </tr>
        <tr>
          <td><strong>Railway</strong></td>
          <td>PaaS container</td>
          <td>Qualquer lib</td>
          <td class="warn">~$5/mÃªs</td>
          <td class="good">âœ… Sim</td>
          <td>Deploy fÃ¡cil via Git</td>
        </tr>
        <tr>
          <td><strong>Fly.io</strong></td>
          <td>Container (edge)</td>
          <td>Qualquer lib</td>
          <td class="good">Free tier / ~$1.94/mÃªs</td>
          <td class="good">âœ… Volumes disponÃ­veis</td>
          <td>Baileys + volume para auth</td>
        </tr>
        <tr>
          <td><strong>Render</strong></td>
          <td>PaaS</td>
          <td>Qualquer lib</td>
          <td class="warn">Free (dorme) / $7/mÃªs</td>
          <td class="warn">âš ï¸ Dorme no free tier</td>
          <td>Meta API + webhooks (paid)</td>
        </tr>
        <tr>
          <td><strong>Vercel / Cloudflare Workers</strong></td>
          <td>Serverless</td>
          <td>Meta Cloud API, Twilio</td>
          <td class="good">Free tier generoso</td>
          <td class="bad">âŒ Stateless apenas</td>
          <td>Meta Cloud API</td>
        </tr>
        <tr>
          <td><strong>Docker self-hosted</strong></td>
          <td>Container</td>
          <td>Qualquer lib</td>
          <td class="good">Custo do servidor base</td>
          <td class="good">âœ… Sim</td>
          <td>Controle total</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="alert info">
    <span>ğŸ’¡</span>
    <div><strong>Dica para Baileys + Docker:</strong> Monte um volume para persistir a pasta <code>auth_info/</code>. Assim o bot nÃ£o pede QR Code a cada redeploy. Em produÃ§Ã£o, implemente um auth state customizado usando Redis ou PostgreSQL.</div>
  </div>

  <div class="grid2" style="margin-top:20px">
    <div class="card">
      <h3><span class="icon">ğŸ³</span> Dockerfile â€” Baileys (Alpine, leve)</h3>
      <pre><code><span class="kw">FROM</span> node:20-alpine
<span class="kw">WORKDIR</span> /app
<span class="kw">COPY</span> package*.json ./
<span class="kw">RUN</span> npm ci --only=production
<span class="kw">COPY</span> dist/ ./dist/
<span class="kw">VOLUME</span> ["/app/auth_info"]
<span class="kw">CMD</span> ["node", "dist/index.js"]</code></pre>
    </div>
    <div class="card">
      <h3><span class="icon">ğŸ³</span> Dockerfile â€” whatsapp-web.js (Chromium)</h3>
      <pre><code><span class="kw">FROM</span> node:20
<span class="kw">RUN</span> apt-get update && apt-get install -y \
  chromium libasound2 libgconf-2-4
<span class="kw">ENV</span> PUPPETEER_SKIP_CHROMIUM_DOWNLOAD=<span class="str">true</span>
<span class="kw">ENV</span> PUPPETEER_EXECUTABLE_PATH=/usr/bin/chromium
<span class="kw">WORKDIR</span> /app
<span class="kw">COPY</span> . .
<span class="kw">RUN</span> npm ci
<span class="kw">VOLUME</span> ["/app/.wwebjs_auth"]
<span class="kw">CMD</span> ["node", "dist/index.js"]</code></pre>
    </div>
  </div>
</section>

<!-- TAB 3: CUSTOS -->
<section id="costs">
  <h2>Custos para Manter no Ar</h2>
  <p class="subtitle">Estimativas mensais para diferentes abordagens e volumes de uso.</p>

  <h3 style="color:var(--text);margin-bottom:16px">ğŸ—ï¸ Infraestrutura (por abordagem)</h3>
  <div class="grid3">
    <div class="cost-card">
      <div class="label">Baileys em VPS</div>
      <div class="price">$4â€“6</div>
      <div class="desc">Hetzner CX11 / DigitalOcean Basic<br/>512 MB RAM suficiente<br/>SessÃ£o WebSocket persistente</div>
    </div>
    <div class="cost-card">
      <div class="label">whatsapp-web.js em VPS</div>
      <div class="price paid">$12â€“20</div>
      <div class="desc">Precisa de 1â€“2 GB RAM<br/>(Puppeteer + Chrome headless)<br/>DigitalOcean Basic 2GB = $12/mÃªs</div>
    </div>
    <div class="cost-card">
      <div class="label">Meta Cloud API â€” Infra</div>
      <div class="price">$0</div>
      <div class="desc">Serverless (Vercel/CF Workers)<br/>Free tiers disponÃ­veis<br/>Webhook stateless puro</div>
    </div>
  </div>

  <h3 style="color:var(--text);margin:28px 0 16px">ğŸ“¨ Meta Cloud API â€” Custo por Mensagem (a partir de jul/2025)</h3>

  <div class="alert success">
    <span>âœ…</span>
    <div><strong>AtualizaÃ§Ã£o importante (jul/2025):</strong> O modelo mudou de <em>por conversa</em> para <em>por mensagem entregue</em>. Mensagens de serviÃ§o (user-initiated, dentro da janela de 24h) sÃ£o <strong>totalmente gratuitas</strong>.</div>
  </div>

  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>Tipo de Mensagem</th><th>Custo (Brasil)</th><th>Quando cobrado</th><th>Exemplo de uso</th></tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>Service / Free-form</strong></td>
          <td class="good">GRATUITO</td>
          <td>Dentro da janela de 24h apÃ³s msg do usuÃ¡rio</td>
          <td>Atendimento, respostas, suporte</td>
        </tr>
        <tr>
          <td><strong>Utility Template</strong> (na janela CSW)</td>
          <td class="good">GRATUITO</td>
          <td>Enviado dentro da Customer Service Window</td>
          <td>ConfirmaÃ§Ã£o de pedido, recibo</td>
        </tr>
        <tr>
          <td><strong>Utility Template</strong> (fora da janela)</td>
          <td class="warn">~$0.02â€“0.04/msg</td>
          <td>Por mensagem entregue</td>
          <td>NotificaÃ§Ã£o de envio, status</td>
        </tr>
        <tr>
          <td><strong>Marketing Template</strong></td>
          <td class="bad">~$0.0625/msg</td>
          <td>Por mensagem entregue</td>
          <td>PromoÃ§Ãµes, campanhas, newsletters</td>
        </tr>
        <tr>
          <td><strong>Authentication Template</strong></td>
          <td class="warn">~$0.01â€“0.03/msg</td>
          <td>Por mensagem entregue</td>
          <td>OTP, 2FA, verificaÃ§Ã£o</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="alert info">
    <span>ğŸ“Š</span>
    <div><strong>Exemplo prÃ¡tico:</strong> Bot de atendimento com 500 usuÃ¡rios/dia, todos respondendo mensagens do usuÃ¡rio â†’ <strong>$0/mÃªs de custo Meta</strong>. Campanha de marketing com 1.000 mensagens â†’ ~$62,50. Volume discount disponÃ­vel a partir de certos thresholds (atÃ© 20% off).</div>
  </div>

  <h3 style="color:var(--text);margin:28px 0 16px">ğŸ†š Resumo Comparativo â€” Custo Total Mensal</h3>
  <div class="tbl-wrap">
    <table>
      <thead>
        <tr><th>CenÃ¡rio</th><th>Abordagem</th><th>Infra/mÃªs</th><th>Custo msgs</th><th>Total estimado</th></tr>
      </thead>
      <tbody>
        <tr>
          <td>Bot pessoal / hobby</td>
          <td>Baileys + Fly.io</td>
          <td class="good">~$0â€“2</td>
          <td class="good">$0</td>
          <td class="good"><strong>~$0â€“2/mÃªs</strong></td>
        </tr>
        <tr>
          <td>Startup / pequeno negÃ³cio</td>
          <td>Baileys + Hetzner VPS</td>
          <td class="good">~$4/mÃªs</td>
          <td class="good">$0</td>
          <td class="good"><strong>~$4/mÃªs</strong></td>
        </tr>
        <tr>
          <td>NegÃ³cio (atendimento puro)</td>
          <td>Meta Cloud API + Vercel</td>
          <td class="good">~$0</td>
          <td class="good">$0 (service msgs)</td>
          <td class="good"><strong>~$0/mÃªs</strong></td>
        </tr>
        <tr>
          <td>NegÃ³cio (marketing ativo)</td>
          <td>Meta Cloud API</td>
          <td class="good">~$0â€“5</td>
          <td class="bad">$60â€“200/mÃªs</td>
          <td class="warn"><strong>$60â€“205/mÃªs</strong></td>
        </tr>
        <tr>
          <td>Prototipagem / sandbox</td>
          <td>Twilio Sandbox</td>
          <td class="good">$0</td>
          <td class="good">$0 (sandbox)</td>
          <td class="good"><strong>$0 (dev only)</strong></td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

<!-- TAB 4: FLUXOS -->
<section id="flows">
  <h2>Fluxos &amp; Arquitetura de ConversaÃ§Ã£o</h2>
  <p class="subtitle">PadrÃµes para gerenciar rotas, menus e fluxos de conversa em TypeScript.</p>

  <div class="arch">
    <div class="arch-box green">UsuÃ¡rio ğŸ“±</div>
    <div class="arch-arrow">â†’</div>
    <div class="arch-box">Message<br/>Receiver</div>
    <div class="arch-arrow">â†’</div>
    <div class="arch-box blue">Command<br/>Router</div>
    <div class="arch-arrow">â†’</div>
    <div class="arch-box purple">State<br/>Manager</div>
    <div class="arch-arrow">â†’</div>
    <div class="arch-box">Handler<br/>Function</div>
    <div class="arch-arrow">â†’</div>
    <div class="arch-box green">Resposta ğŸ“¤</div>
  </div>

  <h3 style="color:var(--text);margin:24px 0 12px">ğŸ“ PadrÃ£o 1 â€” Command Router</h3>
  <p style="color:var(--muted);font-size:.9rem;margin-bottom:4px">Mapeia comandos fixos (<code>!menu</code>, <code>!ajuda</code>) para funÃ§Ãµes handler. Simples e direto.</p>
  <pre><code><span class="cm">// commandRouter.ts</span>
<span class="kw">import</span> { WAMessage, WASocket } <span class="kw">from</span> <span class="str">'baileys'</span>

<span class="kw">type</span> <span class="tp">Handler</span> = (msg: <span class="tp">WAMessage</span>, sock: <span class="tp">WASocket</span>) =&gt; <span class="tp">Promise</span>&lt;<span class="kw">void</span>&gt;

<span class="kw">const</span> commands = <span class="kw">new</span> <span class="tp">Map</span>&lt;<span class="tp">string</span>, <span class="tp">Handler</span>&gt;()

<span class="cm">// Registrar handlers</span>
commands.<span class="fn">set</span>(<span class="str">'!menu'</span>, <span class="kw">async</span> (msg, sock) =&gt; {
  <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
    text: <span class="str">'ğŸ“‹ *Menu Principal*\n1ï¸âƒ£ Suporte\n2ï¸âƒ£ Pedidos\n3ï¸âƒ£ Sair'</span>
  })
})

commands.<span class="fn">set</span>(<span class="str">'!status'</span>, <span class="kw">async</span> (msg, sock) =&gt; {
  <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
    text: <span class="str">'ğŸŸ¢ Sistema operacional!'</span>
  })
})

<span class="cm">// Dispatcher no handler de mensagens</span>
<span class="kw">export function</span> <span class="fn">dispatch</span>(msg: <span class="tp">WAMessage</span>, sock: <span class="tp">WASocket</span>) {
  <span class="kw">const</span> text = msg.message?.conversation?.trim() ?? <span class="str">''</span>
  <span class="kw">const</span> handler = commands.<span class="fn">get</span>(text.<span class="fn">toLowerCase</span>())
  <span class="kw">if</span> (handler) <span class="kw">return</span> <span class="fn">handler</span>(msg, sock)
  <span class="cm">// fallback: mensagem desconhecida</span>
  <span class="kw">return</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
    text: <span class="str">'â“ Comando nÃ£o reconhecido. Digite *!menu* para ver as opÃ§Ãµes.'</span>
  })
}</code></pre>

  <h3 style="color:var(--text);margin:24px 0 12px">ğŸ”„ PadrÃ£o 2 â€” State Machine por UsuÃ¡rio</h3>
  <p style="color:var(--muted);font-size:.9rem;margin-bottom:4px">Cada usuÃ¡rio tem um estado. O bot responde diferente dependendo do estado atual. Ideal para fluxos multi-etapa.</p>
  <pre><code><span class="cm">// stateMachine.ts</span>
<span class="kw">type</span> <span class="tp">State</span> = <span class="str">'idle'</span> | <span class="str">'waiting_name'</span> | <span class="str">'waiting_cpf'</span> | <span class="str">'waiting_confirm'</span>

<span class="kw">interface</span> <span class="tp">UserSession</span> {
  state: <span class="tp">State</span>
  data: <span class="tp">Record</span>&lt;<span class="tp">string</span>, <span class="tp">string</span>&gt;
}

<span class="kw">const</span> sessions = <span class="kw">new</span> <span class="tp">Map</span>&lt;<span class="tp">string</span>, <span class="tp">UserSession</span>&gt;()

<span class="kw">function</span> <span class="fn">getSession</span>(userId: <span class="tp">string</span>): <span class="tp">UserSession</span> {
  <span class="kw">if</span> (!sessions.<span class="fn">has</span>(userId))
    sessions.<span class="fn">set</span>(userId, { state: <span class="str">'idle'</span>, data: {} })
  <span class="kw">return</span> sessions.<span class="fn">get</span>(userId)!
}

<span class="kw">const</span> stateHandlers: <span class="tp">Record</span>&lt;<span class="tp">State</span>, <span class="tp">Handler</span>&gt; = {
  idle: <span class="kw">async</span> (msg, sock) =&gt; {
    <span class="kw">const</span> s = <span class="fn">getSession</span>(msg.key.remoteJid!)
    s.state = <span class="str">'waiting_name'</span>
    <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, { text: <span class="str">'ğŸ‘‹ OlÃ¡! Qual Ã© o seu nome?'</span> })
  },
  waiting_name: <span class="kw">async</span> (msg, sock) =&gt; {
    <span class="kw">const</span> s = <span class="fn">getSession</span>(msg.key.remoteJid!)
    s.data.name = msg.message?.conversation ?? <span class="str">''</span>
    s.state = <span class="str">'waiting_cpf'</span>
    <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
      text: <span class="str">`Oi, ${s.data.name}! Agora informe seu CPF:`</span>
    })
  },
  waiting_cpf: <span class="kw">async</span> (msg, sock) =&gt; {
    <span class="kw">const</span> s = <span class="fn">getSession</span>(msg.key.remoteJid!)
    s.data.cpf = msg.message?.conversation ?? <span class="str">''</span>
    s.state = <span class="str">'waiting_confirm'</span>
    <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
      text: <span class="str">`âœ… Confirmar?\nNome: ${s.data.name}\nCPF: ${s.data.cpf}\n\nResponda *sim* ou *nÃ£o*`</span>
    })
  },
  waiting_confirm: <span class="kw">async</span> (msg, sock) =&gt; {
    <span class="kw">const</span> s = <span class="fn">getSession</span>(msg.key.remoteJid!)
    <span class="kw">if</span> (msg.message?.conversation?.toLowerCase() === <span class="str">'sim'</span>) {
      <span class="kw">await</span> <span class="fn">saveToDb</span>(s.data) <span class="cm">// sua lÃ³gica</span>
      sessions.<span class="fn">delete</span>(msg.key.remoteJid!)
      <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, { text: <span class="str">'ğŸ‰ Cadastro realizado!'</span> })
    } <span class="kw">else</span> {
      sessions.<span class="fn">delete</span>(msg.key.remoteJid!)
      <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, { text: <span class="str">'âŒ Cancelado.'</span> })
    }
  }
}

<span class="cm">// Dispatcher com state machine</span>
<span class="kw">export function</span> <span class="fn">dispatchStateful</span>(msg: <span class="tp">WAMessage</span>, sock: <span class="tp">WASocket</span>) {
  <span class="kw">const</span> jid = msg.key.remoteJid!
  <span class="kw">const</span> session = <span class="fn">getSession</span>(jid)
  <span class="kw">return</span> stateHandlers[session.state](msg, sock)
}</code></pre>

  <h3 style="color:var(--text);margin:24px 0 12px">ğŸ›ï¸ PadrÃ£o 3 â€” Intent Handler (Regex / NLP)</h3>
  <p style="color:var(--muted);font-size:.9rem;margin-bottom:4px">Detecta intenÃ§Ãµes por padrÃ£o. Combina com LLMs ou motores NLU (Dialogflow, Wit.ai) para linguagem natural.</p>
  <pre><code><span class="cm">// intentRouter.ts</span>
<span class="kw">interface</span> <span class="tp">Intent</span> {
  name: <span class="tp">string</span>
  patterns: <span class="tp">RegExp</span>[]
  handler: <span class="tp">Handler</span>
}

<span class="kw">const</span> intents: <span class="tp">Intent</span>[] = [
  {
    name: <span class="str">'greeting'</span>,
    patterns: [<span class="str">/oi|olÃ¡|bom dia|boa tarde|boa noite/i</span>],
    handler: <span class="kw">async</span> (msg, sock) =&gt; {
      <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
        text: <span class="str">'ğŸ‘‹ OlÃ¡! Como posso ajudar hoje?'</span>
      })
    }
  },
  {
    name: <span class="str">'pricing'</span>,
    patterns: [<span class="str">/preÃ§o|valor|quanto custa|custo|plano/i</span>],
    handler: <span class="kw">async</span> (msg, sock) =&gt; {
      <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
        text: <span class="str">'ğŸ’° Nossos planos a partir de R$ 49,90/mÃªs'</span>
      })
    }
  },
  {
    name: <span class="str">'farewell'</span>,
    patterns: [<span class="str">/tchau|atÃ©|adeus|encerrar/i</span>],
    handler: <span class="kw">async</span> (msg, sock) =&gt; {
      sessions.<span class="fn">delete</span>(msg.key.remoteJid!)
      <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(msg.key.remoteJid!, {
        text: <span class="str">'ğŸ‘‹ AtÃ© logo! Ã“timo dia para vocÃª.'</span>
      })
    }
  }
]

<span class="kw">export function</span> <span class="fn">routeByIntent</span>(text: <span class="tp">string</span>): <span class="tp">Handler</span> | <span class="kw">null</span> {
  <span class="kw">for</span> (<span class="kw">const</span> intent <span class="kw">of</span> intents) {
    <span class="kw">if</span> (intent.patterns.<span class="fn">some</span>(p =&gt; p.<span class="fn">test</span>(text))) <span class="kw">return</span> intent.handler
  }
  <span class="kw">return null</span>
}</code></pre>

  <div class="grid2" style="margin-top:20px">
    <div class="card">
      <h3><span class="icon">ğŸ’¡</span> Quando usar cada padrÃ£o?</h3>
      <ul>
        <li><strong>Command Router:</strong> Bots com comandos fixos e previsÃ­veis</li>
        <li><strong>State Machine:</strong> Fluxos multi-etapa: cadastro, checkout, formulÃ¡rio</li>
        <li><strong>Intent Handler:</strong> FAQ, atendimento, linguagem natural</li>
        <li><strong>HÃ­brido:</strong> State machine + intents dentro de cada estado</li>
        <li><strong>LLM-powered:</strong> State machine + ChatGPT/Gemini como handler</li>
      </ul>
    </div>
    <div class="card">
      <h3><span class="icon">ğŸ—„ï¸</span> PersistÃªncia de Estado</h3>
      <ul>
        <li><strong>Map em memÃ³ria:</strong> Simples, perde ao reiniciar o processo</li>
        <li><strong>Redis:</strong> TTL automÃ¡tico, suporte multi-instÃ¢ncia, rÃ¡pido</li>
        <li><strong>PostgreSQL / SQLite:</strong> HistÃ³rico completo, ACID, consultas</li>
        <li><strong>Recomendado produÃ§Ã£o:</strong> Redis para sessÃµes + Postgres para histÃ³rico</li>
      </ul>
    </div>
  </div>
</section>

<!-- TAB 5: QUICK START -->
<section id="quickstart">
  <h2>âš¡ Quick Start â€” Baileys + TypeScript</h2>
  <p class="subtitle">Guia rÃ¡pido para ter um bot rodando em minutos.</p>

  <ol class="steps">
    <li><div class="txt"><strong>Criar o projeto TypeScript</strong><br/>
      <pre><code>mkdir my-wa-bot &amp;&amp; cd my-wa-bot
npm init -y
npm install baileys
npm install -D typescript @types/node ts-node
npx tsc --init</code></pre>
    </div></li>
    <li><div class="txt"><strong>CÃ³digo principal â€” src/index.ts</strong><br/>
      <pre><code><span class="kw">import</span> makeWASocket, {
  DisconnectReason, useMultiFileAuthState
} <span class="kw">from</span> <span class="str">'baileys'</span>
<span class="kw">import</span> { Boom } <span class="kw">from</span> <span class="str">'@hapi/boom'</span>

<span class="kw">async function</span> <span class="fn">startBot</span>(): <span class="tp">Promise</span>&lt;<span class="kw">void</span>&gt; {
  <span class="kw">const</span> { state, saveCreds } =
    <span class="kw">await</span> <span class="fn">useMultiFileAuthState</span>(<span class="str">'auth_info'</span>)

  <span class="kw">const</span> sock = <span class="fn">makeWASocket</span>({
    auth: state,
    printQRInTerminal: <span class="kw">true</span>,
    browser: [<span class="str">'MyBot'</span>, <span class="str">'Chrome'</span>, <span class="str">'1.0.0'</span>],
  })

  <span class="cm">// Persistir credenciais</span>
  sock.ev.<span class="fn">on</span>(<span class="str">'creds.update'</span>, saveCreds)

  <span class="cm">// ReconexÃ£o automÃ¡tica</span>
  sock.ev.<span class="fn">on</span>(<span class="str">'connection.update'</span>, ({ connection, lastDisconnect }) =&gt; {
    <span class="kw">if</span> (connection === <span class="str">'close'</span>) {
      <span class="kw">const</span> code = (lastDisconnect?.error <span class="kw">as</span> <span class="tp">Boom</span>)?.output?.statusCode
      <span class="kw">if</span> (code !== DisconnectReason.loggedOut) <span class="fn">startBot</span>()
    } <span class="kw">else if</span> (connection === <span class="str">'open'</span>) {
      console.<span class="fn">log</span>(<span class="str">'âœ… Bot conectado!'</span>)
    }
  })

  <span class="cm">// Receber e responder mensagens</span>
  sock.ev.<span class="fn">on</span>(<span class="str">'messages.upsert'</span>, <span class="kw">async</span> ({ messages, type }) =&gt; {
    <span class="kw">if</span> (type !== <span class="str">'notify'</span>) <span class="kw">return</span>

    <span class="kw">for</span> (<span class="kw">const</span> msg <span class="kw">of</span> messages) {
      <span class="kw">if</span> (msg.key.fromMe || !msg.message) <span class="kw">continue</span>

      <span class="kw">const</span> jid = msg.key.remoteJid!
      <span class="kw">const</span> text =
        msg.message.conversation ??
        msg.message.extendedTextMessage?.text ?? <span class="str">''</span>

      <span class="kw">if</span> (text.<span class="fn">toLowerCase</span>() === <span class="str">'!ping'</span>) {
        <span class="kw">await</span> sock.<span class="fn">sendMessage</span>(jid, { text: <span class="str">'ğŸ“ Pong!'</span> })
      }
    }
  })
}

<span class="fn">startBot</span>()</code></pre>
    </div></li>
    <li><div class="txt"><strong>Rodar em desenvolvimento</strong><br/>
      <pre><code>npx ts-node src/index.ts
<span class="cm"># Escaneie o QR Code com seu WhatsApp</span>
<span class="cm"># Envie "!ping" para testar</span></code></pre>
    </div></li>
    <li><div class="txt"><strong>Build para produÃ§Ã£o</strong><br/>
      <pre><code>npx tsc           <span class="cm"># compila â†’ dist/</span>
node dist/index.js</code></pre>
    </div></li>
    <li><div class="txt"><strong>Manter ativo com PM2 na VPS</strong><br/>
      <pre><code>npm install -g pm2
pm2 start dist/index.js --name wa-bot
pm2 save &amp;&amp; pm2 startup   <span class="cm"># iniciar com o sistema</span>
pm2 logs wa-bot            <span class="cm"># ver logs</span></code></pre>
    </div></li>
  </ol>

  <div class="alert success">
    <span>âœ…</span>
    <div><strong>Pronto!</strong> Para produÃ§Ã£o: implemente um auth state customizado com Redis/PostgreSQL em vez do <code>useMultiFileAuthState</code> (apenas para dev/demo).</div>
  </div>

  <div class="grid2" style="margin-top:20px">
    <div class="card">
      <h3><span class="icon">ğŸ“š</span> Recursos &amp; Links</h3>
      <ul>
        <li>Docs Baileys: <strong>baileys.wiki</strong></li>
        <li>Repo: <strong>github.com/WhiskeySockets/Baileys</strong></li>
        <li>Meta Cloud API: <strong>developers.facebook.com/docs/whatsapp</strong></li>
        <li>whatsapp-web.js: <strong>wwebjs.dev</strong></li>
        <li>WPPConnect: <strong>wppconnect.io</strong></li>
        <li>Evolution API (wrapper Baileys): <strong>doc.evolution-api.com</strong></li>
      </ul>
    </div>
    <div class="card">
      <h3><span class="icon">ğŸ¯</span> DecisÃ£o RÃ¡pida</h3>
      <ul>
        <li>ğŸ  <strong>Hobby/pessoal:</strong> Baileys + Fly.io (~$0/mÃªs)</li>
        <li>ğŸš€ <strong>Startup:</strong> Baileys + Hetzner CX11 (~$4/mÃªs)</li>
        <li>ğŸ¢ <strong>Empresa (atendimento):</strong> Meta Cloud API + Vercel (~$0)</li>
        <li>ğŸ“£ <strong>Empresa (marketing):</strong> Meta Cloud API + budget msgs</li>
        <li>ğŸ§ª <strong>Testar rÃ¡pido:</strong> Twilio Sandbox (gratuito)</li>
      </ul>
    </div>
  </div>
</section>

</main>

<footer>
  WhatsApp Bot Guide Â· Pesquisa tÃ©cnica gerada automaticamente Â· Fev 2026
</footer>

<script>
  const tabs = document.querySelectorAll('nav button')
  const sections = document.querySelectorAll('section')
  tabs.forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.tab
      tabs.forEach(b => b.classList.remove('active'))
      sections.forEach(s => s.classList.remove('active'))
      btn.classList.add('active')
      document.getElementById(target).classList.add('active')
    })
  })
</script>
</body>
</html>
